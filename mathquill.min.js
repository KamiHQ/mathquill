/**
 * Copyright 2010 Jay and Han (laughinghan@gmail.com)
 * License, Usage and Readme at http://mathquill.com
 *//****************************
 * Important opening stuff.
 ***************************/(function(a){function N(a,b,c){h.apply(this,arguments)}function M(b){this.parent=this.root=b;var c=this.jQ=this._jQ=a('<span class="cursor"></span>');this.blink=function(){c.toggleClass("blink")}}function L(a,b){f.call(this,"\\"+b+" ","<span>"+b+"</span>")}function K(a,b){f.call(this,a,"<big>"+b+"</big>")}function J(a,b){G.apply(this,arguments)}function I(a,b){f.call(this,a,'<span class="binary-operator">'+b+"</span>")}function H(a,b){f.call(this,a,'<span class="nonSymbola">'+(b||a)+"</span>")}function G(a,b){f.call(this,a,"<span>"+(b||a)+"</span>")}function F(a,b){f.call(this,a,"<var>"+(b||a)+"</var>")}function E(a){var b=Array.prototype.slice.call(arguments,1);return o(a,function(){a.apply(this,b)})}function D(a){e.call(this,"\\vector",b,a)}function C(){B.apply(this,arguments)}function B(a){e.call(this,"\\binom",b,a),this.jQ.wrapInner('<span class="array"></span>').prepend('<span class="paren">(</span>').append('<span class="paren">)</span>')}function A(a){e.call(this,"\\"),a&&(this.replacedFragment=a.detach(),this.isEmpty=function(){return!1})}function z(){}function y(a){a instanceof h?this.replacedText=a.remove().jQ.text():typeof a==="string"&&(this.replacedText=a),e.call(this,"\\text")}function x(a){v.call(this,"|","|",a)}function w(a,b,c){u.call(this,a,b,a,b,c)}function v(a,b,c){t.call(this,a,b,a,b,c)}function u(a,b,c,d,e){t.apply(this,arguments)}function t(a,b,c,d,f){e.call(this,"\\left"+c,['<span><span class="paren">'+a+'</span><span></span><span class="paren">'+b+"</span></span>"],f),this.end="\\right"+d}function s(a){e.call(this,"\\sqrt",b,a)}function r(){q.apply(this,arguments)}function q(a){e.call(this,"\\frac",b,a),this.jQ.append('<span style="width:0">&nbsp;</span>')}function p(a,b,c){e.call(this,a,[b],c)}function o(a,b){b.prototype=a.prototype;return b}function l(){}function k(a){e.call(this,"$"),this.firstChild.cursor=a,this.firstChild.keypress=function(b){if(this.skipKeypress)return!0;var c=String.fromCharCode(b.which);c==="$"&&a.parent==this?this.isEmpty()?a.insertAfter(this.parent).backspace().insertNew(new G("\\$","$")).show():a.next?a.prev?a.show().write(c):a.insertBefore(this.parent):a.insertAfter(this.parent):a.show().write(c),b.preventDefault();return!0}}function j(){}function i(b,d,e,f){var g=b.contents().detach();e||b.addClass("mathquill-rendered-math"),d.jQ=b.data(c,{block:d,revert:function(){b.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(g)}});var h=d.cursor=new M(d);d.renderLatex(g.text());if(f){d.textarea=a('<span class="textarea"><textarea></textarea></span>').prependTo(b.addClass("mathquill-editable"));var i=d.textarea.children();e&&b.addClass("mathquill-textbox"),i.focus(function(a){h.parent||h.appendTo(d),h.parent.jQ.addClass("hasCursor"),h.selection?h.selection.jQ.removeClass("blur"):h.show(),a.stopPropagation()}).blur(function(a){h.hide().parent.blur(),h.selection&&h.selection.jQ.addClass("blur"),a.stopPropagation()});var j={};b.bind("keydown.mathquill",function(a){j.evt=a,j.happened=!0,j.returnValue=h.parent.keydown(a);if(j.returnValue)return!0;a.stopImmediatePropagation();return!1}).bind("keypress.mathquill",function(a){j.happened?j.happened=!1:j.returnValue=h.parent.keydown(j.evt);if(!j.returnValue)return!1;if(a.ctrlKey||a.metaKey||a.which<32)return!0;if(h.parent.keypress(a))return!0;a.stopImmediatePropagation();return!1}).bind("click.mathquill",function(b){var d=a(b.target);if(d.hasClass("empty")){h.clearSelection().prependTo(d.data(c).block);return!1}var e=d.data(c);if(e){if(e.cmd&&!e.block){h.clearSelection(),d.outerWidth()>2*(b.pageX-d.offset().left)?h.insertBefore(e.cmd):h.insertAfter(e.cmd);return!1}}else{d=d.parent(),e=d.data(c);if(!e)return}h.clearSelection(),e.cmd?h.insertAfter(e.cmd):h.appendTo(e.block);var f,g,i=h.jQ.offset().left-b.pageX;do h.moveLeft(),f=g,g=i,i=Math.abs(h.jQ.offset().left-b.pageX);while(i<=g&&i!=f);i!=f&&h.moveRight();return!1}).bind("click.mathquill",function(){i.focus()}).bind("focus.mathquill blur.mathquill",function(a){i.trigger(a)}).blur()}}function h(b,c,d){if(arguments.length){var e=this;e.parent=b,e.prev=c||0,e.next=d||0,e.jQinit(e.fold(a(),function(a){return this.jQ.add(a)}))}}function g(){}function f(a,b){e.call(this,a,[b])}function e(b,d,e){if(arguments.length){var f=this;f.cmd=b,d&&(f.html_template=d),f.jQ=a(f.html_template[0]).data(c,{cmd:f}),f.initBlocks(e)}}function d(){}var b,c="[[mathquill internal data]]";d.prototype={prev:0,next:0,parent:0,firstChild:0,lastChild:0,eachChild:function(a){for(var b=this.firstChild;b;b=b.next)if(a.call(b)===!1)break;return this},foldChildren:function(a,b){this.eachChild(function(){a=b.call(this,a)});return a},keydown:function(a){return this.parent.keydown(a)},keypress:function(a){return this.parent.keypress(a)}},e.prototype=a.extend(new d,{initBlocks:function(b){var d=this;if(d.html_template.length===1)d.firstChild=d.lastChild=d.jQ.data(c).block=b&&b.blockify()||new g,d.firstChild.parent=d,d.firstChild.jQ=d.jQ.append(d.firstChild.jQ);else{var e,f,h=d.html_template.length;this.firstChild=e=f=b&&b.blockify()||new g,e.parent=d,e.jQ=a(d.html_template[1]).data(c,{block:e}).append(e.jQ).appendTo(d.jQ),e.blur();for(var i=2;i<h;i+=1)e=new g,e.parent=d,e.prev=f,f.next=e,f=e,e.jQ=a(d.html_template[i]).data(c,{block:e}).appendTo(d.jQ),e.blur();d.lastChild=e}},latex:function(){return this.foldChildren(this.cmd,function(a){return a+"{"+(this.latex()||" ")+"}"})},remove:function(){var a=this,b=a.prev,c=a.next,d=a.parent;b?b.next=c:d.firstChild=c,c?c.prev=b:d.lastChild=b,a.jQ.remove();return a},respace:a.noop,placeCursor:function(a){a.appendTo(this.foldChildren(this.firstChild,function(a){return a.isEmpty()?a:this}))},isEmpty:function(){return this.foldChildren(!0,function(a){return a&&this.isEmpty()})}}),f.prototype=a.extend(new e,{initBlocks:a.noop,latex:function(){return this.cmd},placeCursor:a.noop,isEmpty:function(){return!0}}),g.prototype=a.extend(new d,{latex:function(){return this.foldChildren("",function(a){return a+this.latex()})},isEmpty:function(){return this.firstChild===0&&this.lastChild===0},focus:function(){this.jQ.addClass("hasCursor"),this.isEmpty()&&this.jQ.removeClass("empty");return this},blur:function(){this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty");return this}}),h.prototype={remove:e.prototype.remove,jQinit:function(a){this.jQ=a},each:function(a){for(var b=this.prev.next||this.parent.firstChild;b!==this.next;b=b.next)if(a.call(b)===!1)break;return this},fold:function(a,b){this.each(function(){a=b.call(this,a)});return a},blockify:function(){var a=this,b=a.prev,c=a.next,d=a.parent,e=new g,f=e.firstChild=this.prev.next||this.parent.firstChild,h=e.lastChild=this.next.prev||this.parent.lastChild;b?b.next=c:d.firstChild=c,c?c.prev=b:d.lastChild=b,f.prev=a.prev=0,h.next=a.next=0,a.parent=e,a.each(function(){this.parent=e}),e.jQ=a.jQ;return e}},j.prototype=a.extend(new g,{latex:function(){return g.prototype.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/ig,"$1")},renderLatex:function(a){a=a.match(/\\[a-z]*|[^\s]/ig),this.jQ.children().slice(1).remove(),this.firstChild=this.lastChild=0,this.cursor.show().appendTo(this),a&&function c(d){while(a.length){var e=a.shift();if(!e||e==="}")return;var f;if(e==="\\text"){var g=a.shift();if(g==="{"){g=e=a.shift();while(e!=="}")e==="\\"&&(g+=e=a.shift()),g+=e=a.shift();g=g.slice(0,-1)}f=new y(g),d.insertNew(f).insertAfter(f);continue}if(e==="\\left"||e==="\\right"){e=a.shift(),e==="\\"&&(e=a.shift()),d.write(e),f=d.prev||d.parent.parent;if(d.prev)return;a.unshift("{")}else if(/^\\[a-z]+$/i.test(e)){e=e.slice(1);var f=n[e];if(f)d.insertNew(f=new f(b,e));else{f=new y(e),d.insertNew(f).insertAfter(f);continue}}else e.match(/[a-eg-zA-Z]/)?f=new F(e):(f=n[e])?f=new f:f=new G(e),d.insertNew(f);f.eachChild(function(){d.appendTo(this);var b=a.shift();if(!b)return!1;b==="{"?c(d):d.write(b)}),d.insertAfter(f)}}(this.cursor),this.cursor.hide(),this.blur()},keydown:function(a){this.skipKeypress=!0,a.ctrlKey=a.ctrlKey||a.metaKey;switch(a.originalEvent&&a.originalEvent.keyIdentifier||a.which){case 8:case"Backspace":case"U+0008":if(a.ctrlKey)while(this.cursor.prev)this.cursor.backspace();else this.cursor.backspace();break;case 27:case"Esc":case"U+001B":case 9:case"Tab":case"U+0009":if(a.ctrlKey)break;var b=this.cursor.parent;if(a.shiftKey){if(b===this)break;b.prev?this.cursor.appendTo(b.prev):this.cursor.insertBefore(b.parent)}else{if(b===this)return this.skipKeypress=!0;b.next?this.cursor.prependTo(b.next):this.cursor.insertAfter(b.parent)}this.cursor.clearSelection();return!1;case 13:case"Enter":a.preventDefault();break;case 35:case"End":if(a.shiftKey)while(this.cursor.next||a.ctrlKey&&this.cursor.parent!==this)this.cursor.selectRight();else this.cursor.clearSelection().appendTo(a.ctrlKey?this:this.cursor.parent);break;case 36:case"Home":if(a.shiftKey)while(this.cursor.prev||a.ctrlKey&&this.cursor.parent!==this)this.cursor.selectLeft();else this.cursor.clearSelection().prependTo(a.ctrlKey?this:this.cursor.parent);break;case 37:case"Left":if(a.ctrlKey)break;a.shiftKey?this.cursor.selectLeft():this.cursor.moveLeft();break;case 38:case"Up":if(a.ctrlKey)break;if(a.shiftKey)if(this.cursor.prev)while(this.cursor.prev)this.cursor.selectLeft();else this.cursor.selectLeft();else this.cursor.parent.prev?this.cursor.clearSelection().appendTo(this.cursor.parent.prev):this.cursor.prev?this.cursor.clearSelection().prependTo(this.cursor.parent):this.cursor.parent!==this&&this.cursor.clearSelection().insertBefore(this.cursor.parent.parent);break;case 39:case"Right":if(a.ctrlKey)break;a.shiftKey?this.cursor.selectRight():this.cursor.moveRight();break;case 40:case"Down":if(a.ctrlKey)break;if(a.shiftKey)if(this.cursor.next)while(this.cursor.next)this.cursor.selectRight();else this.cursor.selectRight();else this.cursor.parent.next?this.cursor.clearSelection().prependTo(this.cursor.parent.next):this.cursor.next?this.cursor.clearSelection().appendTo(this.cursor.parent):this.cursor.parent!==this&&this.cursor.clearSelection().insertAfter(this.cursor.parent.parent);break;case 46:case"Del":case"U+007F":if(a.ctrlKey)while(this.cursor.next)this.cursor.deleteForward();else this.cursor.deleteForward();break;case 65:case"A":case"U+0041":if(!a.ctrlKey||a.shiftKey||a.altKey){this.skipKeypress=!1;break}if(this.parent)return this.parent.keydown(a);this.cursor.clearSelection().appendTo(this);while(this.cursor.prev)this.cursor.selectLeft();break;default:this.skipKeypress=!1}return!0},keypress:function(a){if(this.skipKeypress)return!0;this.cursor.show().write(String.fromCharCode(a.which)),a.preventDefault();return!0}}),k.prototype=a.extend(new e,{html_template:['<span class="mathquill-rendered-math"></span>'],initBlocks:function(){this.firstChild=this.lastChild=this.jQ.data(c).block=new j,this.firstChild.parent=this,this.firstChild.jQ=this.jQ}}),l.prototype=a.extend(new g,{renderLatex:function(a){this.jQ.children().slice(1).remove(),this.firstChild=this.lastChild=0,this.cursor.show().appendTo(this);var b,c,d;while(a){b=c="",d=a.indexOf("$"),d<0?(c=a,a=""):(c=a.slice(0,d),a=a.slice(d+1));for(var e=0;e<c.length;e+=1)this.cursor.insertNew(new G(c.charAt(e)));d=a.indexOf("$"),d<0?(b=a,a=""):(b=a.slice(0,d),a=a.slice(d+1));if(b){var f=new k(this.cursor);this.cursor.insertNew(f),f.firstChild.renderLatex(b),this.cursor.show().insertAfter(f)}}},keydown:j.prototype.keydown,keypress:function(a){if(this.skipKeypress)return!0;this.cursor.deleteSelection();var b=String.fromCharCode(a.which);b==="$"?this.cursor.insertNew(new k(this.cursor)):this.cursor.insertNew(new G(b)),a.preventDefault();return!0}});var m={},n={};p.prototype=new e,p.prototype.latex=function(){var a=this.firstChild.latex();return a.length===1?this.cmd+a:this.cmd+"{"+(a||" ")+"}"},p.prototype.redraw=function(){this.respace(),this.next&&this.next.respace(),this.prev&&this.prev.respace()},p.prototype.respace=function(){this.prev&&(this.prev.cmd==="\\int "||this.prev instanceof p&&this.prev.cmd!=this.cmd&&this.prev.prev&&this.prev.prev.cmd==="\\int ")?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),(this.respaced=this.prev instanceof p&&this.prev.cmd!=this.cmd&&!this.prev.respaced)?this.limit&&this.cmd==="_"?this.jQ.css({left:-.25-this.prev.jQ.outerWidth()/+this.jQ.css("fontSize").slice(0,-2)+"em",marginRight:.1-Math.min(this.jQ.outerWidth(),this.prev.jQ.outerWidth())/+this.jQ.css("fontSize").slice(0,-2)+"em"}):this.jQ.css({left:-this.prev.jQ.outerWidth()/+this.jQ.css("fontSize").slice(0,-2)+"em",marginRight:.1-Math.min(this.jQ.outerWidth(),this.prev.jQ.outerWidth())/+this.jQ.css("fontSize").slice(0,-2)+"em"}):this.limit&&this.cmd==="_"?this.jQ.css({left:"-.25em",marginRight:""}):this.cmd==="^"&&this.next&&this.next.cmd==="\\sqrt"?this.jQ.css({left:"",marginRight:Math.max(-.3,.1-this.jQ.outerWidth()/+this.jQ.css("fontSize").slice(0,-2))+"em"}).addClass("limit"):this.jQ.css({left:"",marginRight:""});return this},n.subscript=n._=o(p,function(a){p.call(this,"_","<sub></sub>",a)}),n.superscript=n.supscript=n["^"]=o(p,function(a){p.call(this,"^","<sup></sup>",a)}),q.prototype=new e,q.prototype.html_template=['<span class="fraction"></span>','<span class="numerator"></span>','<span class="denominator"></span>'],n.frac=n.fraction=q,r.prototype=new q,r.prototype.placeCursor=function(a){if(this.firstChild.isEmpty()){var b=this.prev;while(b&&!(b instanceof I||b instanceof y||b instanceof K))b=b.prev;b instanceof K&&b.next instanceof p&&(b=b.next,b.next instanceof p&&b.next.cmd!=b.cmd&&(b=b.next));if(b!==this.prev){var d=(new h(this.parent,b,this)).blockify();d.jQ=this.firstChild.jQ.empty().removeClass("empty").append(d.jQ).data(c,{block:d}),d.next=this.lastChild,d.parent=this,this.firstChild=this.lastChild.prev=d}}a.appendTo(this.lastChild)},m["/"]=r,s.prototype=new e,s.prototype.html_template=['<span><span class="sqrt-prefix">&radic;</span></span>','<span class="sqrt-stem"></span>'],s.prototype.redraw=function(){var a=this.firstChild.jQ,b=a.outerHeight(!0);a.css({borderTopWidth:b/28+1}).prev().css({fontSize:.9*b/+a.css("fontSize").slice(0,-2)+"em"})},n.sqrt=s,t.prototype=new e,t.prototype.initBlocks=function(a){this.firstChild=this.lastChild=a&&a.blockify()||new g,this.firstChild.parent=this,this.firstChild.jQ=this.jQ.children(":eq(1)").data(c,{block:this.firstChild}).append(this.firstChild.jQ)},t.prototype.latex=function(){return this.cmd+this.firstChild.latex()+this.end},t.prototype.redraw=function(){var a=this.firstChild.jQ;a.prev().add(a.next()).css("fontSize",a.outerHeight()/(+a.css("fontSize").slice(0,-2)*1.02)+"em")},n.lbrace=m["{"]=o(t,function(a){t.call(this,"{","}","\\{","\\}",a)}),n.langle=n.lang=o(t,function(a){t.call(this,"&lang;","&rang;","\\langle ","\\rangle ",a)}),u.prototype=new t,u.prototype.placeCursor=function(a){!this.next&&this.parent.parent&&this.parent.parent.end===this.end&&this.firstChild.isEmpty()?a.backspace().insertAfter(this.parent.parent):this.firstChild.blur()},n.rbrace=m["}"]=o(u,function(a){u.call(this,"{","}","\\{","\\}",a)}),n.rangle=n.rang=o(u,function(a){u.call(this,"&lang;","&rang;","\\langle ","\\rangle ",a)}),v.prototype=t.prototype,n.lparen=m["("]=o(v,function(a){v.call(this,"(",")",a)}),n.lbrack=n.lbracket=m["["]=o(v,function(a){v.call(this,"[","]",a)}),w.prototype=u.prototype,n.rparen=m[")"]=o(w,function(a){w.call(this,"(",")",a)}),n.rbrack=n.rbracket=m["]"]=o(w,function(a){w.call(this,"[","]",a)}),x.prototype=new v,x.prototype.placeCursor=function(a){!this.next&&this.parent.parent&&this.parent.parent.end===this.end&&this.firstChild.isEmpty()?a.backspace().insertAfter(this.parent.parent):a.appendTo(this.firstChild)},n.lpipe=n.rpipe=m["|"]=x,y.prototype=a.extend(new e,{html_template:['<span class="text"></span>'],initBlocks:function(){this.firstChild=this.lastChild=this.jQ.data(c).block=new z,this.firstChild.parent=this,this.firstChild.jQ=this.jQ.append(this.firstChild.jQ)},placeCursor:function(a){(this.cursor=a).appendTo(this.firstChild);if(this.replacedText)for(var b=0;b<this.replacedText.length;b+=1)this.write(this.replacedText.charAt(b))},write:function(a){this.cursor.insertNew(new G(a))},keydown:function(a){if(!this.cursor.selection&&(a.which===8&&!this.cursor.prev||a.which===46&&!this.cursor.next)){this.isEmpty()&&this.cursor.insertAfter(this);return!1}return this.parent.keydown(a)},keypress:function(a){this.cursor.deleteSelection();var b=String.fromCharCode(a.which);if(b!=="$")this.write(b);else if(this.isEmpty())this.cursor.insertAfter(this).backspace().insertNew(new G("\\$","$"));else if(this.cursor.next)if(this.cursor.prev){var c=new y(new h(this.firstChild,this.cursor.prev));c.placeCursor=function(a){this.prev=0,delete this.placeCursor,this.placeCursor(a)},c.firstChild.focus=function(){return this},this.cursor.insertAfter(this).insertNew(c),c.prev=this,this.cursor.insertBefore(c),delete c.firstChild.focus}else this.cursor.insertBefore(this);else this.cursor.insertAfter(this);return!1}}),z.prototype=a.extend(new g,{blur:function(){this.jQ.removeClass("hasCursor");if(this.isEmpty()){var a=this.parent,b=a.cursor;b.parent===this?this.jQ.addClass("empty"):(b.hide(),a.remove(),b.next===a?b.next=a.next:b.prev===a&&(b.prev=a.prev),b.show().redraw())}return this},focus:function(){g.prototype.focus.call(this);var a=this.parent;if(a.next instanceof y){var b=this,c=a.cursor,d=a.next.firstChild;d.eachChild(function(){this.parent=b,this.jQ.appendTo(b.jQ)}),this.lastChild?this.lastChild.next=d.firstChild:this.firstChild=d.firstChild,d.firstChild.prev=this.lastChild,this.lastChild=d.lastChild,d.parent.remove(),c.prev?c.insertAfter(c.prev):c.prependTo(this),c.redraw()}else if(a.prev instanceof y){var c=a.cursor;c.prev?a.prev.firstChild.focus():c.appendTo(a.prev.firstChild)}return this}}),n.text=m.$=y,A.prototype=a.extend(new e,{html_template:['<span class="latex-command-input"></span>'],placeCursor:function(a){this.cursor=a.appendTo(this.firstChild),this.replacedFragment&&(this.jQ=this.jQ.add(this.replacedFragment.jQ.addClass("blur").insertBefore(this.jQ)))},latex:function(){return"\\"+this.firstChild.latex()+" "},keydown:function(a){if(a.which===9||a.which===13){this.renderCommand();return!1}return this.parent.keydown(a)},keypress:function(a){var b=String.fromCharCode(a.which);if(b.match(/[a-z]/i)){this.cursor.deleteSelection(),this.cursor.insertNew(new G(b));return!1}this.renderCommand();if(b===" "||b==="\\"&&this.firstChild.isEmpty())return!1;return this.cursor.parent.keypress(a)},renderCommand:function(){this.jQ=this.jQ.last(),this.remove(),this.next?this.cursor.insertBefore(this.next):this.cursor.appendTo(this.parent);var a=this.firstChild.latex(),b;if(a)if(b=n[a])b=new b(this.replacedFragment,a);else{b=new y(a),b.firstChild.focus=function(){delete this.focus;return!0},this.cursor.insertNew(b).insertAfter(b),this.replacedFragment&&this.replacedFragment.remove();return}else b=new G("\\backslash ","\\");this.cursor.insertNew(b),b instanceof f&&this.replacedFragment&&this.replacedFragment.remove()}}),m["\\"]=A,B.prototype=new e,B.prototype.html_template=["<span></span>","<span></span>","<span></span>"],B.prototype.redraw=function(){this.jQ.children(":first").add(this.jQ.children(":last")).css("fontSize",this.jQ.outerHeight()/(+this.jQ.css("fontSize").slice(0,-2)*.9+2)+"em")},n.binom=n.binomial=B,C.prototype=new B,C.prototype.placeCursor=r.prototype.placeCursor,n.choose=C,D.prototype=new e,D.prototype.html_template=['<span class="array"></span>',"<span></span>"],D.prototype.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(a){a.push(this.latex());return a}).join("\\\\")+"\\end{matrix}"},D.prototype.placeCursor=function(a){this.cursor=a.appendTo(this.firstChild)},D.prototype.keydown=function(b){var d=this.cursor.parent;if(d.parent===this){if(b.which===13){var e=new g;e.parent=this,e.jQ=a("<span></span>").data(c,{block:e}).insertAfter(d.jQ),d.next?d.next.prev=e:this.lastChild=e,e.next=d.next,d.next=e,e.prev=d,this.cursor.appendTo(e).redraw();return!1}if(b.which===9&&!b.shiftKey&&!d.next){if(d.isEmpty()){if(d.prev){this.cursor.insertAfter(this),delete d.prev.next,this.lastChild=d.prev,d.jQ.remove(),this.cursor.redraw();return!1}return this.parent.keydown(b)}var e=new g;e.parent=this,e.jQ=a("<span></span>").data(c,{block:e}).appendTo(this.jQ),this.lastChild=e,d.next=e,e.prev=d,this.cursor.appendTo(e).redraw();return!1}if(b.which===8){if(d.isEmpty()){d.prev?(this.cursor.appendTo(d.prev),d.prev.next=d.next):(this.cursor.insertBefore(this),this.firstChild=d.next),d.next?d.next.prev=d.prev:this.lastChild=d.prev,d.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.cursor.redraw();return!1}if(!this.cursor.prev)return!1}}return this.parent.keydown(b)},n.vector=D,n.editable=o(k,function(){e.call(this,"\\editable"),i(this.jQ,this.firstChild,!1,!0);var a;this.placeCursor=function(b){a=b.appendTo(this.firstChild)},this.firstChild.blur=function(){a.prev===this.parent&&(delete this.blur,this.cursor.appendTo(this),g.prototype.blur.call(this))}}),n.f=E(f,"f",'<var class="florin">&fnof;</var>'),F.prototype=f.prototype,G.prototype=f.prototype,m[" "]=E(G,"\\:"," "),n.prime=m["'"]=E(G,"'","&prime;"),H.prototype=f.prototype,n["@"]=H,n["&"]=E(H,"\\&","&"),n["%"]=E(H,"\\%","%"),n.alpha=n.beta=n.gamma=n.delta=n.zeta=n.eta=n.theta=n.iota=n.kappa=n.mu=n.nu=n.xi=n.rho=n.sigma=n.tau=n.chi=n.psi=n.omega=o(f,function(a,b){F.call(this,"\\"+b+" ","&"+b+";")}),n.phi=E(F,"\\phi ","&#981;"),n.phiv=n.varphi=E(F,"\\varphi ","&phi;"),n.epsilon=E(F,"\\epsilon ","&#1013;"),n.epsiv=n.varepsilon=E(F,"\\varepsilon ","&epsilon;"),n.sigmaf=n.sigmav=n.varsigma=E(F,"\\varsigma ","&sigmaf;"),n.upsilon=n.upsi=E(F,"\\upsilon ","&upsilon;"),n.gammad=n.Gammad=n.digamma=E(F,"\\digamma ","&#989;"),n.kappav=n.varkappa=E(F,"\\varkappa ","&#1008;"),n.piv=n.varpi=E(F,"\\varpi ","&#982;"),n.rhov=n.varrho=E(F,"\\varrho ","&#1009;"),n.thetav=n.vartheta=E(F,"\\vartheta ","&#977;"),n.pi=E(H,"\\pi ","&pi;"),n.lambda=E(H,"\\lambda ","&lambda;"),n.Upsilon=n.Upsi=E(F,"\\Upsilon ","&Upsilon;"),n.Gamma=n.Delta=n.Theta=n.Lambda=n.Xi=n.Pi=n.Sigma=n.Phi=n.Psi=n.Omega=n.forall=o(f,function(a,b){G.call(this,"\\"+b+" ","&"+b+";")}),I.prototype=new f,J.prototype=new I,J.prototype.respace=function(){this.prev?this.prev instanceof I&&this.next&&!(this.next instanceof I)?this.jQ[0].className="unary-operator":this.jQ[0].className="binary-operator":this.jQ[0].className="";return this},n["+"]=E(J,"+"),n["-"]=E(J,"-","&minus;"),n.pm=n.plusmn=n.plusminus=E(J,"\\pm ","&plusmn;"),n.mp=n.mnplus=n.minusplus=E(J,"\\mp ","&#8723;"),m["*"]=n.sdot=n.cdot=E(I,"\\cdot ","&middot;"),n["="]=E(I,"=","="),n["<"]=E(I,"<","&lt;"),n[">"]=E(I,">","&gt;"),n.notin=n.sim=n.cong=n.equiv=n.times=n.oplus=n.otimes=o(I,function(a,b){I.call(this,"\\"+b+" ","&"+b+";")}),n.div=n.divide=n.divides=E(I,"\\div ","&divide;"),n.ne=n.neq=E(I,"\\ne ","&ne;"),n.ast=n.star=n.loast=n.lowast=E(I,"\\ast ","&lowast;"),n.therefor=n.therefore=E(I,"\\therefore ","&there4;"),n.cuz=n.because=E(I,"\\because ","&#8757;"),n.prop=n.propto=E(I,"\\propto ","&prop;"),n.asymp=n.approx=E(I,"\\approx ","&asymp;"),n.lt=E(I,"<","&lt;"),n.gt=E(I,"<","&gt;"),n.le=n.leq=E(I,"\\le ","&le;"),n.ge=n.geq=E(I,"\\ge ","&ge;"),n.isin=n["in"]=E(I,"\\in ","&isin;"),n.ni=n.contains=E(I,"\\ni ","&ni;"),n.notni=n.niton=n.notcontains=n.doesnotcontain=E(I,"\\not\\ni ","&#8716;"),n.sub=n.subset=E(I,"\\subset ","&sub;"),n.sup=n.supset=n.superset=E(I,"\\supset ","&sup;"),n.nsub=n.notsub=n.nsubset=n.notsubset=E(I,"\\not\\subset ","&#8836;"),n.nsup=n.notsup=n.nsupset=n.notsupset=n.nsuperset=n.notsuperset=E(I,"\\not\\supset ","&#8837;"),n.sube=n.subeq=n.subsete=n.subseteq=E(I,"\\subseteq ","&sube;"),n.supe=n.supeq=n.supsete=n.supseteq=n.supersete=n.superseteq=E(I,"\\supseteq ","&supe;"),n.nsube=n.nsubeq=n.notsube=n.notsubeq=n.nsubsete=n.nsubseteq=n.notsubsete=n.notsubseteq=E(I,"\\not\\subseteq ","&#8840;"),n.nsupe=n.nsupeq=n.notsupe=n.notsupeq=n.nsupsete=n.nsupseteq=n.notsupsete=n.notsupseteq=n.nsupersete=n.nsuperseteq=n.notsupersete=n.notsuperseteq=E(I,"\\not\\supseteq ","&#8841;"),K.prototype=new f,n.sum=n.summation=E(K,"\\sum ","&sum;"),n.prod=n.product=E(K,"\\prod ","&prod;"),n.coprod=n.coproduct=E(K,"\\coprod ","&#8720;"),n.int=n.integral=E(K,"\\int ","&int;"),n.N=n.naturals=n.Naturals=E(G,"\\mathbb{N}","&#8469;"),n.P=n.primes=n.Primes=n.projective=n.Projective=n.probability=n.Probability=E(G,"\\mathbb{P}","&#8473;"),n.Z=n.integers=n.Integers=E(G,"\\mathbb{Z}","&#8484;"),n.Q=n.rationals=n.Rationals=E(G,"\\mathbb{Q}","&#8474;"),n.R=n.reals=n.Reals=E(G,"\\mathbb{R}","&#8477;"),n.C=n.complex=n.Complex=n.complexes=n.Complexes=n.complexplane=n.Complexplane=n.ComplexPlane=E(G,"\\mathbb{C}","&#8450;"),n.H=n.Hamiltonian=n.quaternions=n.Quaternions=E(G,"\\mathbb{H}","&#8461;"),n.quad=n.emsp=E(G,"\\quad ","    "),n.qquad=E(G,"\\qquad ","        "),n.diamond=E(G,"\\diamond","&#9671;"),n.bigtriangleup=E(G,"\\bigtriangleup","&#9651;"),n.ominus=E(G,"\\ominus","&#8854;"),n.uplus=E(G,"\\uplus","&#8846;"),n.bigtriangledown=E(G,"\\bigtriangledown","&#9661;"),n.sqcap=E(G,"\\sqcap","&#8851;"),n.triangleleft=E(G,"\\triangleleft","&#8882;"),n.sqcup=E(G,"\\sqcup","&#8852;"),n.triangleright=E(G,"\\triangleright","&#8883;"),n.odot=E(G,"\\odot","&#8857;"),n.bigcirc=E(G,"\\bigcirc","&#9711;"),n.dagger=E(G,"\\dagger","&#0134;"),n.ddagger=E(G,"\\ddagger","&#135;"),n.wr=E(G,"\\wr","&#8768;"),n.amalg=E(G,"\\amalg","&#8720;"),n.models=E(G,"\\models","&#8872;"),n.prec=E(G,"\\prec","&#8826;"),n.succ=E(G,"\\succ","&#8827;"),n.preceq=E(G,"\\preceq","&#8828;"),n.succeq=E(G,"\\succeq","&#8829;"),n.simeq=E(G,"\\simeq","&#8771;"),n.mid=E(G,"\\mid","&#8739;"),n.ll=E(G,"\\ll","&#8810;"),n.gg=E(G,"\\gg","&#8811;"),n.parallel=E(G,"\\parallel","&#8741;"),n.bowtie=E(G,"\\bowtie","&#8904;"),n.sqsubset=E(G,"\\sqsubset","&#8847;"),n.sqsupset=E(G,"\\sqsupset","&#8848;"),n.smile=E(G,"\\smile","&#8995;"),n.sqsubseteq=E(G,"\\sqsubseteq","&#8849;"),n.sqsupseteq=E(G,"\\sqsupseteq","&#8850;"),n.doteq=E(G,"\\doteq","&#8784;"),n.frown=E(G,"\\frown","&#8994;"),n.vdash=E(G,"\\vdash","&#8870;"),n.dashv=E(G,"\\dashv","&#8867;"),n.longleftarrow=E(G,"\\longleftarrow","&#8592;"),n.longrightarrow=E(G,"\\longrightarrow","&#8594;"),n.Longleftarrow=E(G,"\\Longleftarrow","&#8656;"),n.Longrightarrow=E(G,"\\Longrightarrow","&#8658;"),n.longleftrightarrow=E(G,"\\longleftrightarrow","&#8596;"),n.updownarrow=E(G,"\\updownarrow","&#8597;"),n.Longleftrightarrow=E(G,"\\Longleftrightarrow","&#8660;"),n.Updownarrow=E(G,"\\Updownarrow","&#8661;"),n.mapsto=E(G,"\\mapsto","&#8614;"),n.nearrow=E(G,"\\nearrow","&#8599;"),n.hookleftarrow=E(G,"\\hookleftarrow","&#8617;"),n.hookrightarrow=E(G,"\\hookrightarrow","&#8618;"),n.searrow=E(G,"\\searrow","&#8600;"),n.leftharpoonup=E(G,"\\leftharpoonup","&#8636;"),n.rightharpoonup=E(G,"\\rightharpoonup","&#8640;"),n.swarrow=E(G,"\\swarrow","&#8601;"),n.leftharpoondown=E(G,"\\leftharpoondown","&#8637;"),n.rightharpoondown=E(G,"\\rightharpoondown","&#8641;"),n.nwarrow=E(G,"\\nwarrow","&#8598;"),n.ldots=E(G,"\\ldots","&#8230;"),n.cdots=E(G,"\\cdots","&#8943;"),n.vdots=E(G,"\\vdots","&#8942;"),n.ddots=E(G,"\\ddots","&#8944;"),n.surd=E(G,"\\surd","&#8730;"),n.triangle=E(G,"\\triangle","&#9653;"),n.ell=E(G,"\\ell","&#8467;"),n.top=E(G,"\\top","&#8868;"),n.flat=E(G,"\\flat","&#9837;"),n.natural=E(G,"\\natural","&#9838;"),n.sharp=E(G,"\\sharp","&#9839;"),n.wp=E(G,"\\wp","&#8472;"),n.bot=E(G,"\\bot","&#8869;"),n.clubsuit=E(G,"\\clubsuit","&#9827;"),n.diamondsuit=E(G,"\\diamondsuit","&#9826;"),n.heartsuit=E(G,"\\heartsuit","&#9825;"),n.spadesuit=E(G,"\\spadesuit","&#9824;"),n.oint=E(G,"\\oint","&#8750;"),n.bigcap=E(G,"\\bigcap","&#8745;"),n.bigcup=E(G,"\\bigcup","&#8746;"),n.bigsqcup=E(G,"\\bigsqcup","&#8852;"),n.bigvee=E(G,"\\bigvee","&#8744;"),n.bigwedge=E(G,"\\bigwedge","&#8743;"),n.bigodot=E(G,"\\bigodot","&#8857;"),n.bigotimes=E(G,"\\bigotimes","&#8855;"),n.bigoplus=E(G,"\\bigoplus","&#8853;"),n.biguplus=E(G,"\\biguplus","&#8846;"),n.lfloor=E(G,"\\lfloor","&#8970;"),n.rfloor=E(G,"\\rfloor","&#8971;"),n.lceil=E(G,"\\lceil","&#8968;"),n.rceil=E(G,"\\rceil","&#8969;"),n.langle=E(G,"\\langle","&#9001;"),n.rangle=E(G,"\\rangle","&#9002;"),n.slash=E(G,"\\slash","&#47;"),n.opencurlybrace=E(G,"\\opencurlybrace","&#123;"),n.closecurlybrace=E(G,"\\closecurlybrace","&#125;"),n.caret=E(G,"\\caret ","^"),n.underscore=E(G,"\\underscore ","_"),n.backslash=E(G,"\\backslash ","\\"),n.vert=E(G,"|"),n.perp=n.perpendicular=E(G,"\\perp ","&perp;"),n.nabla=n.del=E(G,"\\nabla ","&nabla;"),n.hbar=E(G,"\\hbar ","&#8463;"),n.AA=n.Angstrom=n.angstrom=E(G,"\\text\\AA ","&#8491;"),n.ring=n.circ=n.circle=E(G,"\\circ ","&#8728;"),n.bull=n.bullet=E(G,"\\bullet ","&bull;"),n.setminus=n.smallsetminus=E(G,"\\setminus ","&#8726;"),n.not=n.neg=E(G,"\\neg ","&not;"),n.dots=n.ellip=n.hellip=n.ellipsis=n.hellipsis=E(G,"\\dots ","&hellip;"),n.converges=n.darr=n.dnarr=n.dnarrow=n.downarrow=E(G,"\\downarrow ","&darr;"),n.dArr=n.dnArr=n.dnArrow=n.Downarrow=E(G,"\\Downarrow ","&dArr;"),n.diverges=n.uarr=n.uparrow=E(G,"\\uparrow ","&uarr;"),n.uArr=n.Uparrow=E(G,"\\Uparrow ","&uArr;"),n.to=E(I,"\\to ","&rarr;"),n.rarr=n.rightarrow=E(G,"\\rightarrow ","&rarr;"),n.implies=E(I,"\\Rightarrow ","&rArr;"),n.rArr=n.Rightarrow=E(G,"\\Rightarrow ","&rArr;"),n.gets=E(I,"\\gets ","&larr;"),n.larr=n.leftarrow=E(G,"\\leftarrow ","&larr;"),n.impliedby=E(I,"\\Leftarrow ","&lArr;"),n.lArr=n.Leftarrow=E(G,"\\Leftarrow ","&lArr;"),n.harr=n.lrarr=n.leftrightarrow=E(G,"\\leftrightarrow ","&harr;"),n.iff=E(I,"\\Leftrightarrow ","&hArr;"),n.hArr=n.lrArr=n.Leftrightarrow=E(G,"\\Leftrightarrow ","&hArr;"),n.Re=n.Real=n.real=E(G,"\\Re ","&real;"),n.Im=n.imag=n.image=n.imagin=n.imaginary=n.Imaginary=E(G,"\\Im ","&image;"),n.part=n.partial=E(G,"\\partial ","&part;"),n.inf=n.infin=n.infty=n.infinity=E(G,"\\infty ","&infin;"),n.alef=n.alefsym=n.aleph=n.alephsym=E(G,"\\aleph ","&alefsym;"),n.xist=n.xists=n.exist=n.exists=E(G,"\\exists ","&exist;"),n.and=n.land=n.wedge=E(G,"\\wedge ","&and;"),n.or=n.lor=n.vee=E(G,"\\vee ","&or;"),n.o=n.O=n.empty=n.emptyset=n.oslash=n.Oslash=n.nothing=n.varnothing=E(I,"\\varnothing ","&empty;"),n.cup=n.union=E(G,"\\cup ","&cup;"),n.cap=n.intersect=n.intersection=E(G,"\\cap ","&cap;"),n.deg=n.degree=E(G,"^\\circ ","&deg;"),n.ang=n.angle=E(G,"\\angle ","&ang;"),L.prototype=new f,L.prototype.respace=function(){this.jQ[0].className=this.next instanceof p||this.next instanceof t?"":"non-italicized-function"},n.ln=n.lg=n.log=n.span=n.proj=n.det=n.dim=n.min=n.max=n.mod=n.lcm=n.gcd=n.gcf=n.hcf=n.lim=L,function(){var a=["sin","cos","tan","sec","cosec","csc","cotan","cot"];for(var b in a)n[a[b]]=n[a[b]+"h"]=n["a"+a[b]]=n["arc"+a[b]]=n["a"+a[b]+"h"]=n["arc"+a[b]+"h"]=L}(),M.prototype={prev:0,next:0,parent:0,show:function(){this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this.next?this.selection&&this.selection.prev===this.prev?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this.next.jQ):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500);return this},hide:function(){"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=a();return this},redraw:function(){for(var a=this.parent;a;a=a.parent)a.redraw&&a.redraw()},insertAt:function(a,b,c){var d=this.parent;this.parent=a,this.next=b,this.prev=c,d.blur()},insertBefore:function(a){this.insertAt(a.parent,a,a.prev),this.parent.jQ.addClass("hasCursor"),this.jQ.insertBefore(a.jQ.first());return this},insertAfter:function(a){this.insertAt(a.parent,a.next,a),this.parent.jQ.addClass("hasCursor"),this.jQ.insertAfter(a.jQ.last());return this},prependTo:function(a){this.insertAt(a,a.firstChild,0),a.textarea?this.jQ.insertAfter(a.textarea):this.jQ.prependTo(a.jQ),a.focus();return this},appendTo:function(a){this.insertAt(a,0,a.lastChild),this.jQ.appendTo(a.jQ),a.focus();return this},hopLeft:function(){this.jQ.insertBefore(this.prev.jQ.first()),this.next=this.prev,this.prev=this.prev.prev;return this},hopRight:function(){this.jQ.insertAfter(this.next.jQ.last()),this.prev=this.next,this.next=this.next.next;return this},moveLeft:function(){this.selection?this.insertBefore(this.selection.prev.next||this.parent.firstChild).clearSelection():this.prev?this.prev.lastChild?this.appendTo(this.prev.lastChild):this.hopLeft():this.parent.prev?this.appendTo(this.parent.prev):this.parent!==this.root&&this.insertBefore(this.parent.parent);return this.show()},moveRight:function(){this.selection?this.insertAfter(this.selection.next.prev||this.parent.lastChild).clearSelection():this.next?this.next.firstChild?this.prependTo(this.next.firstChild):this.hopRight():this.parent.next?this.prependTo(this.parent.next):this.parent!==this.root&&this.insertAfter(this.parent.parent);return this.show()},write:function(a){this.selection&&(this.prev=this.selection.prev,this.next=this.selection.next);var b;a.match(/^[a-eg-zA-Z]$/)?b=new F(a):(b=m[a]||n[a])?b=new b(this.selection,a):b=new G(a),this.selection&&(b instanceof f&&this.selection.remove(),delete this.selection);return this.insertNew(b)},insertNew:function(a){a.parent=this.parent,a.next=this.next,a.prev=this.prev,this.prev?this.prev.next=a:this.parent.firstChild=a,this.next?this.next.prev=a:this.parent.lastChild=a,a.jQ.insertBefore(this.jQ),this.prev=a,a.respace(),this.next&&this.next.respace(),this.prev&&this.prev.respace(),a.placeCursor(this),this.redraw();return this},unwrapGramp:function(){var a=this.parent.parent,b=a.parent,c=a.prev,d=this;a.eachChild(function(){this.isEmpty()||(this.eachChild(function(){this.parent=b,this.jQ.insertBefore(a.jQ)}),this.firstChild.prev=c,c?c.next=this.firstChild:b.firstChild=this.firstChild,c=this.lastChild)}),c.next=a.next,a.next?a.next.prev=c:b.lastChild=c;if(!this.next)if(this.prev)this.next=this.prev.next;else while(!this.next){this.parent=this.parent.next;if(this.parent)this.next=this.parent.firstChild;else{this.next=a.next,this.parent=b;break}}this.next?this.insertBefore(this.next):this.appendTo(b),a.jQ.remove(),a.prev&&a.prev.respace(),a.next&&a.next.respace()},backspace:function(){if(!this.deleteSelection())if(this.prev)this.prev.isEmpty()?this.prev=this.prev.remove().prev:this.selectLeft();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertAfter(this.parent.parent).backspace();this.unwrapGramp()}this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.redraw();return this},deleteForward:function(){if(!this.deleteSelection())if(this.next)this.next.isEmpty()?this.next=this.next.remove().next:this.selectRight();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertBefore(this.parent.parent).deleteForward();this.unwrapGramp()}this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.redraw();return this},selectLeft:function(){this.selection?this.selection.prev===this.prev?this.prev?(this.hopLeft().next.jQ.prependTo(this.selection.jQ),this.selection.prev=this.prev):this.parent!==this.root&&this.insertBefore(this.parent.parent).selection.levelUp():(this.prev.jQ.insertAfter(this.selection.jQ),this.hopLeft().selection.next=this.next,this.selection.prev===this.prev&&this.deleteSelection()):(this.prev?this.hopLeft():this.parent!==this.root&&this.insertBefore(this.parent.parent),this.hide().selection=new N(this.parent,this.prev,this.next.next))},selectRight:function(){this.selection?this.selection.next===this.next?this.next?(this.hopRight().prev.jQ.appendTo(this.selection.jQ),this.selection.next=this.next):this.parent!==this.root&&this.insertAfter(this.parent.parent).selection.levelUp():(this.next.jQ.insertBefore(this.selection.jQ),this.hopRight().selection.prev=this.prev,this.selection.next===this.next&&this.deleteSelection()):(this.next?this.hopRight():this.parent!==this.root&&this.insertAfter(this.parent.parent),this.hide().selection=new N(this.parent,this.prev.prev,this.next))},clearSelection:function(){this.show().selection&&(this.selection.clear(),delete this.selection);return this},deleteSelection:function(){if(!this.show().selection)return!1;this.prev=this.selection.prev,this.next=this.selection.next,this.selection.remove(),delete this.selection;return!0}},N.prototype=a.extend(new h,{jQinit:function(a){this.jQ=a.wrapAll('<span class="selection"></span>').parent()},levelUp:function(){this.clear().jQinit(this.parent.parent.jQ),this.prev=this.parent.parent.prev,this.next=this.parent.parent.next,this.parent=this.parent.parent.parent;return this},clear:function(){this.jQ.replaceWith(this.jQ.children());return this},blockify:function(){this.jQ.replaceWith(this.jQ=this.jQ.children());return h.prototype.blockify.call(this)},detach:function(){var a=h.prototype.blockify.call(this);this.blockify=function(){this.jQ.replaceWith(a.jQ=this.jQ=this.jQ.children());return a};return this}}),a.fn.mathquill=function(b,d){switch(b){case"redraw":this.find(":not(:has(:first))").mathquill(c).cmd.redraw();return this;case"revert":return this.each(function(){var b=a(this).data(c);b&&b.revert&&b.revert()});case"latex":if(arguments.length>1)return this.each(function(){var b=a(this).data(c);b&&b.block&&b.block.renderLatex&&b.block.renderLatex(d)});var e=this.data(c);return e&&e.block&&e.block.latex();case"html":return this.html().replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":d=d.charAt(0)==="\\"?d.slice(1):d;if(arguments.length>1)return this.each(function(){var b=a(this).data(c),e=b&&b.block,f=e&&e.cursor;f&&(f.show().write(d),e.blur())});default:var f=b==="textbox",g=f||b==="editable",h=f?l:j;return this.each(function(){i(a(this),new h,f,g)})}},a(function(){a(".mathquill-editable").mathquill("editable"),a(".mathquill-textbox").mathquill("textbox"),a(".mathquill-embedded-latex").mathquill()})})(jQuery)